<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <style type="text/css">code{white-space: pre;}</style>
  <link href="data:text/css;charset=utf-8,body%0A%7B%0Afont%2Dfamily%3A%20arial%2C%20sans%2Dserif%3B%0Amax%2Dwidth%3A%206%2E75in%3B%0Amargin%3A%200px%20auto%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ains%20%7Bbackground%2Dcolor%3A%20%23CCFFCC%3B%20text%2Ddecoration%3A%20none%3B%7D%0Adel%20%7Bbackground%2Dcolor%3A%20%23FFCACA%3B%20text%2Ddecoration%3A%20none%3B%7D%0Apre%20%7Bbackground%2Dcolor%3A%20%23D7EEFF%3B%20font%2Dsize%3A%2095%25%3B%20font%2Dfamily%3A%20%22courier%20new%22%2C%20courier%2C%20serif%3B%7D%0Acode%20%7Bfont%2Dsize%3A%20110%25%3B%20font%2Dfamily%3A%20%22courier%20new%22%2C%20courier%2C%20serif%3B%7D%0Atable%20%7Bfont%2Dsize%3A%2090%25%3B%7D%0A%0A" rel="stylesheet" type="text/css" />
<title>UTF Encoding Conversion</title>
</head>

<body>
<table>
<tr>
  <td align="left">Doc. no.:</td>
  <td align="left"><span style="background-color:yellow">DxxxxR0</span></td>
</tr>
<tr>
  <td align="left">Date:</td>
  <td align="left">
  <!--webbot bot="Timestamp" S-Type="EDITED" S-Format="%Y-%m-%d" startspan -->2016-04-02<!--webbot bot="Timestamp" endspan i-checksum="12266" --></td>
</tr>
<tr>
  <td align="left">Reply to:</td>
  <td align="left">Beman Dawes &lt;bdawes at acm dot org&gt;
</tr>
<tr>
  <td align="left">Audience:</td>
  <td align="left">Library Evolution</td>
</tr>
</table>



<h2 >Requirements</h2>



<p ><b>[1] No changes to the core language</b></p>



<p ><b>[2] No changes to the existing standard library</b></p>



<p ><b>[3] Support multiple <code>char</code> string environments</b></p>
<ul>
  <li>Code where <code>char</code> based strings are assumed by default to be 
  UTF-8 encoded.<ul>
  <li>Because that is the default encoding for the operating system, and there 
  is no expectation of moving the code elsewhere.</li>
  <li>Because within a given section of code&nbsp; <code>char</code> based 
  strings are known to be UTF-8 encoded.</li>
</ul>



  </li>
  <li>Code where <code>char</code> based strings are assumed by default to <b>
  not</b> be UTF-8 encoded.<ul>
  <li>Because the default encoding for the operating system is not UTF-8, and 
  there is no expectation of moving the code elsewhere.</li>
  <li>Because within a given section of code <code>char</code> based strings are 
  known to be non-UTF-8 encoded.</li>
</ul>



  </li>
  <li>Portable code that must not make assumptions about the default encoding of <code>
  char</code> based strings</li>
</ul>



<p ><b>[4] Utilize existing codecvt facets for conversions to and from non-UTF 
encoded <code>char</code> based strings </b></p>



<h2 >Design decisions</h2>



<p ><b>No changes to the core language</b></p>
<blockquote>



<p >Types <code>char</code>, <code>char16_t</code>, <code>char32_t</code>, and
<code>wchar_t</code> remain unchanged, and there is no change to current 
requirements on their encodings.</p>



<p >No new core language character types are proposed.</p>
</blockquote>



<p ><b>Proposed changes to the standard library are pure additions</b></p>



<p >&nbsp;</p>



<p ><b>Its all about string encoding needs</b></p>



<p ><b>Provide three levels of functionality</b></p>
<blockquote>



<p >Provide high-level easy-to-use encoding conversion functions that handle 
everyday string interoperability needs. Keep the interfaces simple, but do 
support error handling customization since user needs vary widely.</p>



<p >Provide mid-level generic string encoding to support those requiring the 
full range of string interoperability needs.</p>



<p >Provide a low-level encoding conversion algorithm patterned after existing standard 
library algorithms for those who need to perform encoding conversions on 
sequences of characters.</p>
</blockquote>



<p ><b>Provide the three levels of functionality for both codecvt-based and UTF-based 
conversions</b></p>



<blockquote>



<p ><b>Codecvt-based</b> </p>



</blockquote>



<p ><b>Default error handling in favor of security.</b></p>



<p ><b>Provide a coherent error detection policy so that users know when they do 
and when they do not have to check for errors themselves</b></p>



<p ><b>Provide error checking functions so that users can easily check strings 
or sequences for valid UTF encoding.</b></p>
<p ><b>Default encoding is Unicode Transformation Format (UTF)</b></p>
<p >Unless otherwise specified, all functions in namespace <code>
unicode</code> assume UTF-8, UTF-16, and UTF-32 encoding for <code>char</code>,
<code>char16_t</code>, and <code>char32_t</code> strings, respectively.</p>
<p ><code>wchar_t</code> strings are encoded as UTF-8, UTF-16, or 
UTF-32, according on the <code>sizeof(wchar_t)</code>.</p>
<h2 dir="ltr" >TODO</h2>
<p >TODO: The only use of the encodings tags is as the <code>ToEncoding</code> 
template parameter for <code>convert_utf</code>. Try eliminating all the 
encoding machinery, and replacing <code>ToEncoding</code> template parameter 
with <code>ToCharT</code>.</p>
<p >TODO: String inserters and extractors. See the old string_interop repo.</p>
<p >TODO: Also provide throwing error handler. Design for exception type to be 
thrown.</p>
<p >TODO: Add function that scans a sequence / string for errors, reports 
results.</p>
<p >TODO: Follow Marshall&#39;s suggested return of pair&lt;&gt; from string algorithms?</p>
<p >TODO: UTF first, last, iterators are InputIterators? 
ForwardIterators? RandomAccess? Contiguous? What does basic_string_view require? How does iterator category interact with error handler? If the actual 
conversion is done by functions requiring const char* point to a contiguous 
string, to lesser categories of iterators actually work?</p>
<p >TODO: Add test cases for other kinds of strings to regression 
tests</p>
<p >TODO: add static asserts on character types, other requirements.</p>
<p >TODO: Arguments for error handler?</p>
<p >&nbsp;</p>
<h2 >Bikeshed</h2>
<p >Namespace choice:</p>
<blockquote>
<p >utf<br>
unicode</p>
</blockquote>
<p >&nbsp;</p>
<p >&nbsp;</p>
<p >&nbsp;</p>



</body>

</html>